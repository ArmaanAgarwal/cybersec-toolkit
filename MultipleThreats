from IPython.display import display, Markdown
import random
import matplotlib.pyplot as plt
import logging
import pandas as pd
import seaborn as sns

# ✅ Logger
def log_attack(attack_type, message):
    logging.info(f"{attack_type}: {message}")
    print(f"🔍 Log -> {attack_type}: {message}")

# 🔐 Encryption algorithm recommendations
ENCRYPTION_ALGORITHMS = {
    "Spoofing": ["AES", "RSA", "SSL/TLS"],
    "Phishing": ["AES", "RSA", "ECC"],
    "DDoS": ["IPSec", "SSL/TLS"],
    "SQL Injection": ["AES", "RSA"],
    "Brute Force": ["RSA"],
    "Zero-Day Exploit": ["RSA", "ECC", "AES"]
}

def get_recommended_encryption(attack_type):
    return ENCRYPTION_ALGORITHMS.get(attack_type, ["No recommendation found"])

# ✅ Spoofing Simulation
def simulate_spoofing():
    display(Markdown("## 🎭 Simulating Spoofing Attack"))
    fake_ips = [f"192.168.1.{random.randint(1, 255)}" for _ in range(10)]
    spoof_counts = [random.randint(10, 40) for _ in fake_ips]
    log_attack("Spoofing", f"Fake IPs used: {fake_ips}")

    df = pd.DataFrame({'IP': fake_ips, 'Packets Sent': spoof_counts})
    display(df)

    plt.figure(figsize=(7, 3))
    plt.plot(df['Packets Sent'], marker='o', color='orange')
    plt.title("📊 Spoofed Packet Flow")
    plt.xlabel("Fake IP Index")
    plt.ylabel("Packet Count")
    plt.grid(True)
    plt.tight_layout()
    plt.show()

    display(Markdown(f"🔐 **Recommended Encryption:** `{', '.join(get_recommended_encryption('Spoofing'))}`"))
    return "Spoofing simulation completed."

# ✅ Phishing Simulation
def simulate_phishing():
    display(Markdown("## 🕵️ Simulating Phishing Attack"))
    fake_emails = [f"alert@{s}.com" for s in ['bank', 'social', 'update']]
    open_rates = [random.randint(50, 120) for _ in fake_emails]
    log_attack("Phishing", f"Emails: {fake_emails}")

    df = pd.DataFrame({'Fake Email': fake_emails, 'Opens': open_rates})
    display(df)

    plt.figure(figsize=(7, 3))
    sns.barplot(x='Fake Email', y='Opens', data=df, palette='Blues')
    plt.title("📊 Phishing Email Open Rate")
    plt.tight_layout()
    plt.show()

    display(Markdown(f"🔐 **Recommended Encryption:** `{', '.join(get_recommended_encryption('Phishing'))}`"))
    return "Phishing simulation completed."

# ✅ DDoS Simulation
def simulate_ddos():
    display(Markdown("## 🌐 Simulating DDoS Attack"))
    packet_rate = [random.randint(100, 500) for _ in range(10)]
    log_attack("DDoS", f"Simulated flood rate: {packet_rate}")

    plt.figure(figsize=(7, 3))
    plt.plot(packet_rate, marker='x', color='red')
    plt.title("📊 DDoS Packet Rate")
    plt.xlabel("Time Tick")
    plt.ylabel("Packets/sec")
    plt.grid(True)
    plt.tight_layout()
    plt.show()

    display(Markdown(f"🔐 **Recommended Encryption:** `{', '.join(get_recommended_encryption('DDoS'))}`"))
    return "DDoS simulation completed."

# ✅ SQL Injection Simulation
def simulate_sql_injection():
    display(Markdown("## 🖥️ Simulating SQL Injection Attack"))
    fake_payloads = ["' OR 1=1--", "' OR 'a'='a", "1; DROP TABLE users", "admin'--"]
    target_url = f"http://vulnerable-site{random.randint(1, 50)}.com"

    execution_rates = [random.randint(5, 20) for _ in fake_payloads]
    df = pd.DataFrame({'Payload': fake_payloads, 'Executions': execution_rates})
    display(Markdown(f"**Target URL:** `{target_url}`"))
    display(df)

    for payload in fake_payloads:
        log_attack("SQL Injection", f"Payload: {payload} -> Target: {target_url}")

    plt.figure(figsize=(7, 3))
    sns.barplot(x="Payload", y="Executions", data=df, palette="Greens")
    plt.title("📊 SQL Injection Execution Attempts")
    plt.xticks(rotation=45)
    plt.grid(True)
    plt.tight_layout()
    plt.show()

    display(Markdown(f"🔐 **Recommended Encryption:** `{', '.join(get_recommended_encryption('SQL Injection'))}`"))
    return "SQL Injection simulation completed."

# ✅ Brute Force Simulation
def simulate_brute_force():
    display(Markdown("## 🔐 Simulating Brute Force Attack"))
    users = ["admin", "user", "root"]
    passwords = ["123456", "admin123", "letmein"]
    attempts = [(u, p) for u in users for p in passwords]
    delays = [random.randint(50, 300) for _ in attempts]

    df = pd.DataFrame(attempts, columns=["Username", "Password"])
    df["Response Delay (ms)"] = delays
    compromised = random.choice(attempts)

    display(df.head(10))
    log_attack("Brute Force", f"Compromised account: {compromised[0]}/{compromised[1]}")

    plt.figure(figsize=(7, 3))
    plt.plot(df["Response Delay (ms)"], marker='o', color='purple')
    plt.axvline(5, color='red', linestyle='--', label='Lockout Threshold')
    plt.title("📊 Brute Force Login Delays")
    plt.xlabel("Attempt #")
    plt.ylabel("Delay (ms)")
    plt.grid(True)
    plt.legend()
    plt.tight_layout()
    plt.show()

    display(Markdown(f"🔐 **Recommended Encryption:** `{', '.join(get_recommended_encryption('Brute Force'))}`"))
    return "Brute Force simulation completed."

# ✅ Zero-Day Exploit Simulation
def simulate_zero_day():
    display(Markdown("## 💻 Simulating Zero-Day Exploit"))
    cve_id = f"CVE-2025-{random.randint(1000, 9999)}"
    system = f"Server-{random.randint(10, 99)}"
    compromise_score = round(random.uniform(0.6, 0.99), 2)

    display(Markdown(f"🧪 **Vulnerability ID:** `{cve_id}`"))
    display(Markdown(f"🖥️ **Target System:** `{system}`"))
    display(Markdown(f"📈 **Compromise Probability:** `{compromise_score * 100:.2f}%`"))

    values = [min(max(random.gauss(compromise_score * 100, 10), 0), 100) for _ in range(40)]
    sns.histplot(values, bins=12, kde=True, color='brown')
    plt.title("📊 Exploit Probability Distribution")
    plt.xlabel("Compromise (%)")
    plt.ylabel("Frequency")
    plt.grid(True)
    plt.tight_layout()
    plt.show()

    log_attack("Zero-Day Exploit", f"{cve_id} on {system} | Risk: {compromise_score}")
    display(Markdown(f"🔐 **Recommended Encryption:** `{', '.join(get_recommended_encryption('Zero-Day Exploit'))}`"))
    return "Zero-Day Exploit simulation completed."

# ✅ Final Endpoint Security Check
def security_check():
    display(Markdown("## 🔒 Performing Final Endpoint Security Check"))
    attack_results = {
        "Spoofing": simulate_spoofing(),
        "Phishing": simulate_phishing(),
        "DDoS": simulate_ddos(),
        "SQL Injection": simulate_sql_injection(),
        "Brute Force": simulate_brute_force(),
        "Zero-Day Exploit": simulate_zero_day()
    }

    for name, result in attack_results.items():
        print(f"✅ {name}: {result}")

    log_attack("Final Security Check", "✅ All attack simulations executed.")
    display(Markdown("### ✅ All attacks simulated and logged."))

# ✅ Run the full simulation suite
security_check()
